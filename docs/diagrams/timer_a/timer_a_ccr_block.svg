<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="800" viewBox="0 0 1000 800">
  <defs>
    <!-- Define styles for consistent appearance -->
    <style>
      .block-rect { fill: #f0f8ff; stroke: #1e3a8a; stroke-width: 2; }
      .multiplexor { fill: #fff3cd; stroke: #856404; stroke-width: 2; }
      .logic-gate { fill: #e8f5e8; stroke: #2e7d32; stroke-width: 2; }
      .register { fill: #fff3e0; stroke: #e65100; stroke-width: 2; }
      .comparator { fill: #fce4ec; stroke: #c2185b; stroke-width: 2; }
      .flipflop { fill: #f3e5f5; stroke: #6a1b9a; stroke-width: 2; }
      .connection { stroke: #333; stroke-width: 2; fill: none; }
      .bus { stroke: #333; stroke-width: 3; fill: none; }
      .label { font-family: Arial, sans-serif; font-size: 11px; fill: #333; text-anchor: middle; }
      .signal-label { font-family: Arial, sans-serif; font-size: 9px; fill: #666; text-anchor: middle; }
      .connection-dot { fill: #333; }
      .branch-point { fill: #333; }
    </style>
    
    <!-- Arrow marker definition -->
    <marker id="arrowhead" markerWidth="6" markerHeight="4" refX="6" refY="2" orient="auto">
      <polygon points="0 0, 6 2, 0 4" fill="#333" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="500" y="25" class="label" style="font-size: 16px; font-weight: bold;">CCR (Capture/Compare Register) Block Diagram</text>
  
  <!-- Input Selection Section -->
  <text x="120" y="55" class="label" style="font-size: 14px; fill: #666;">Input Selection</text>
  
  <!-- Input signals -->
  <text x="40" y="85" class="signal-label">CCInA</text>
  <text x="40" y="105" class="signal-label">CCInB</text>
  <text x="40" y="125" class="signal-label">GND</text>
  <text x="40" y="145" class="signal-label">VCC</text>
  
  <!-- CCIS Multiplexor -->
  <polygon points="90,75 140,85 140,145 90,155 90,75" class="multiplexor"/>
  <text x="115" y="110" class="label">CCIS</text>
  <text x="115" y="123" class="label" style="font-size: 9px;">2-bit MUX</text>
  <text x="95" y="93" class="signal-label">00</text>
  <text x="95" y="113" class="signal-label">01</text>
  <text x="95" y="133" class="signal-label">10</text>
  <text x="95" y="153" class="signal-label">11</text>

  <!-- Input connections to CCIS -->
  <line x1="70" y1="85" x2="90" y2="85" class="connection" marker-end="url(#arrowhead)"/>
  <line x1="70" y1="105" x2="90" y2="105" class="connection" marker-end="url(#arrowhead)"/>
  <line x1="70" y1="125" x2="90" y2="125" class="connection" marker-end="url(#arrowhead)"/>
  <line x1="70" y1="145" x2="90" y2="145" class="connection" marker-end="url(#arrowhead)"/>

  <!-- CCI signal output -->
  <line x1="140" y1="115" x2="200" y2="115" class="connection"/>
  <text x="170" y="110" class="signal-label">CCI</text>

  <!-- CCI distribution point -->
  <circle cx="200" cy="115" r="3" class="branch-point"/>
  <line x1="200" y1="115" x2="200" y2="210" class="connection"/>
  <line x1="200" y1="210" x2="200" y2="350" class="connection"/>
  
  <!-- Capture Logic Section -->
  <text x="390" y="55" class="label" style="font-size: 14px; fill: #666;">Capture Logic</text>
  
  <!-- CM (Capture Mode) -->
  <rect x="250" y="180" width="80" height="60" class="logic-gate"/>
  <text x="290" y="200" class="label">CM</text>
  <text x="290" y="213" class="label" style="font-size: 9px;">Capture Mode</text>
  <text x="290" y="225" class="label" style="font-size: 8px;">2-bit Control</text>
  
  <!-- CCI to CM connection -->
  <line x1="200" y1="210" x2="250" y2="210" class="connection" marker-end="url(#arrowhead)"/>
  
  <!-- Logic Block -->
  <rect x="380" y="170" width="60" height="40" class="logic-gate"/>
  <text x="410" y="195" class="label">Logic</text>
  
  <!-- CM to Logic connection -->
  <line x1="330" y1="190" x2="380" y2="190" class="connection" marker-end="url(#arrowhead)"/>
  
  <!-- COV output -->
  <text x="480" y="195" class="signal-label">COV</text>
  <line x1="440" y1="190" x2="460" y2="190" class="connection" marker-end="url(#arrowhead)"/>
  
  <!-- Sync Block -->
  <rect x="380" y="220" width="60" height="40" class="logic-gate"/>
  <text x="410" y="245" class="label">Sync</text>
  
  <!-- CM to Sync connection -->
  <line x1="330" y1="210" x2="350" y2="210" class="connection"/>
  <line x1="350" y1="210" x2="350" y2="240" class="connection"/>
  <line x1="350" y1="240" x2="380" y2="240" class="connection" marker-end="url(#arrowhead)"/>
  
  <!-- Timer Clock input to Sync -->
  <text x="340" y="280" class="signal-label">Timer Clock</text>
  <line x1="370" y1="280" x2="410" y2="280" class="connection"/>
  <line x1="410" y1="280" x2="410" y2="260" class="connection" marker-end="url(#arrowhead)"/>
  <text x="390" y="275" class="signal-label">CLK</text>
  
  <!-- SCS (Synchronize Capture Source) -->
  <polygon points="480,215 530,225 530,255 480,265 480,215" class="multiplexor"/>
  <text x="505" y="235" class="label">SCS</text>
  <text x="505" y="248" class="label" style="font-size: 8px;">Sync</text>
  
  <!-- Sync to SCS connection -->
  <line x1="440" y1="240" x2="480" y2="240" class="connection" marker-end="url(#arrowhead)"/>
  
  <!-- CM direct to SCS connection (rerouted to avoid overlap) -->
  <line x1="330" y1="200" x2="360" y2="200" class="connection"/>
  <line x1="360" y1="200" x2="360" y2="140" class="connection"/>
  <line x1="360" y1="140" x2="460" y2="140" class="connection"/>
  <line x1="460" y1="140" x2="460" y2="225" class="connection"/>
  <line x1="460" y1="225" x2="480" y2="225" class="connection" marker-end="url(#arrowhead)"/>
  <text x="470" y="220" class="signal-label">0</text>
  <text x="470" y="250" class="signal-label">1</text>
  
  <!-- CAP (Capture) Multiplexor -->
  <polygon points="600,210 650,220 650,260 600,270 600,210" class="multiplexor"/>
  <text x="625" y="235" class="label">CAP</text>
  <text x="625" y="248" class="label" style="font-size: 8px;">Mode</text>
  
  <!-- SCS to CAP connection -->
  <line x1="530" y1="240" x2="600" y2="240" class="connection" marker-end="url(#arrowhead)"/>
  <text x="590" y="255" class="signal-label">1</text>
  
  <!-- Storage and Compare Section -->
  <text x="320" y="300" class="label" style="font-size: 14px; fill: #666;">Storage and Compare</text>
  
  <!-- TAxCCRn Register -->
  <rect x="250" y="330" width="100" height="60" class="register"/>
  <text x="300" y="350" class="label">TAxCCRn</text>
  <text x="300" y="363" class="label" style="font-size: 9px;">16-bit Register</text>
  
  <!-- CAP to TAxCCRn connection -->
  <line x1="650" y1="240" x2="680" y2="240" class="connection"/>
  <line x1="680" y1="240" x2="680" y2="320" class="connection"/>
  <line x1="680" y1="320" x2="320" y2="320" class="connection"/>
  <line x1="320" y1="320" x2="320" y2="330" class="connection" marker-end="url(#arrowhead)"/>
  <text x="330" y="315" class="signal-label">Sync</text>
  
  <!-- Timer Count Bus input -->
  <text x="180" y="370" class="signal-label">Timer Count</text>
  <text x="180" y="380" class="signal-label">(16-bit Bus)</text>
  <line x1="220" y1="370" x2="250" y2="370" class="bus" marker-end="url(#arrowhead)"/>
  
  <!-- Comparator -->
  <rect x="400" y="330" width="80" height="60" class="comparator"/>
  <text x="440" y="350" class="label">Compare</text>
  <text x="440" y="363" class="label" style="font-size: 9px;">16-bit</text>
  <text x="440" y="375" class="label" style="font-size: 9px;">Equality</text>
  
  <!-- TAxCCRn to Comparator connection -->
  <line x1="350" y1="350" x2="400" y2="350" class="bus" marker-end="url(#arrowhead)"/>
  <text x="375" y="345" class="signal-label">CCR</text>
  
  <!-- Timer Count to Comparator connection -->
  <line x1="220" y1="380" x2="390" y2="380" class="bus"/>
  <line x1="390" y1="380" x2="390" y2="370" class="bus"/>
  <line x1="390" y1="370" x2="400" y2="370" class="bus" marker-end="url(#arrowhead)"/>
  <text x="375" y="385" class="signal-label">Count</text>
  
  <!-- Equ output from Comparator -->
  <line x1="480" y1="360" x2="520" y2="360" class="connection"/>
  <text x="500" y="355" class="signal-label">Equ</text>
  
  <!-- Equ distribution point -->
  <circle cx="520" cy="360" r="3" class="branch-point"/>
  <line x1="520" y1="360" x2="520" y2="250" class="connection"/>
  <line x1="520" y1="360" x2="520" y2="450" class="connection"/>
  
  <!-- Equ to CAP connection -->
  <line x1="520" y1="250" x2="580" y2="250" class="connection"/>
  <line x1="580" y1="250" x2="580" y2="225" class="connection"/>
  <line x1="580" y1="225" x2="600" y2="225" class="connection" marker-end="url(#arrowhead)"/>
  <text x="590" y="220" class="signal-label">0</text>
  
  <!-- CCILatch -->
  <rect x="530" y="320" width="70" height="40" class="flipflop"/>
  <text x="565" y="340" class="label">CCILatch</text>
  
  <!-- CCI to CCILatch (rerouted to avoid overlap) -->
  <line x1="200" y1="350" x2="200" y2="410" class="connection"/>
  <line x1="200" y1="410" x2="490" y2="410" class="connection"/>
  <line x1="490" y1="410" x2="490" y2="340" class="connection"/>
  <line x1="490" y1="340" x2="530" y2="340" class="connection" marker-end="url(#arrowhead)"/>
  <text x="495" y="335" class="signal-label">A</text>
  
  <!-- Equ to CCILatch EN -->
  <line x1="520" y1="350" x2="530" y2="350" class="connection" marker-end="url(#arrowhead)"/>
  <text x="510" y="345" class="signal-label">EN</text>
  
  <!-- SCCI output -->
  <text x="640" y="340" class="signal-label">SCCI</text>
  <line x1="600" y1="340" x2="620" y2="340" class="connection" marker-end="url(#arrowhead)"/>
  
  <!-- CCIFG output -->
  <rect x="720" y="215" width="60" height="30" class="block-rect"/>
  <text x="750" y="235" class="label" style="font-size: 10px;">CCIFG</text>
  <line x1="650" y1="230" x2="720" y2="230" class="connection" marker-end="url(#arrowhead)"/>
  <text x="685" y="225" class="signal-label">set</text>
  
  <!-- Output Logic Section -->
  <text x="450" y="480" class="label" style="font-size: 14px; fill: #666;">Output Logic</text>
  
  <!-- OutputUnit4 -->
  <rect x="370" y="500" width="100" height="80" class="logic-gate"/>
  <text x="420" y="525" class="label">OutputUnit4</text>
  <text x="420" y="538" class="label" style="font-size: 9px;">8 Output Modes</text>
  <text x="420" y="550" class="label" style="font-size: 9px;">3-bit Control</text>
  
  <!-- OUTMOD input -->
  <text x="300" y="530" class="signal-label">OUTMOD</text>
  <text x="300" y="540" class="signal-label">(3-bit)</text>
  <line x1="330" y1="530" x2="370" y2="530" class="connection" marker-end="url(#arrowhead)"/>
  
  <!-- Equ to OutputUnit4 -->
  <line x1="520" y1="450" x2="420" y2="450" class="connection"/>
  <line x1="420" y1="450" x2="420" y2="500" class="connection" marker-end="url(#arrowhead)"/>
  <text x="430" y="475" class="signal-label">Equ6</text>
  
  <!-- Logic Gates for Output Mode -->
  <!-- NOR Gate (taller for 3 inputs) -->
  <path d="M 170 615 C 170 615 175 617 180 630 C 185 643 190 655 200 655 C 190 655 185 657 180 650 C 175 643 170 645 170 645 Z" class="logic-gate"/>
  <circle cx="208" cy="635" r="3" fill="none" stroke="#2e7d32" stroke-width="2"/>
  <text x="185" y="640" class="label" style="font-size: 10px;">NOR</text>
  
  <!-- OUTMOD bits to NOR -->
  <text x="120" y="620" class="signal-label">OUTMOD[0]</text>
  <text x="120" y="635" class="signal-label">OUTMOD[1]</text>
  <text x="120" y="650" class="signal-label">OUTMOD[2]</text>
  <line x1="150" y1="620" x2="170" y2="620" class="connection" marker-end="url(#arrowhead)"/>
  <line x1="150" y1="635" x2="170" y2="635" class="connection" marker-end="url(#arrowhead)"/>
  <line x1="150" y1="650" x2="170" y2="650" class="connection" marker-end="url(#arrowhead)"/>
  
  <!-- AND Gate -->
  <path d="M 275 590 L 300 590 A 10 10 0 0 1 300 610 L 275 610 Z" class="logic-gate"/>
  <text x="287" y="605" class="label" style="font-size: 10px;">AND</text>
  
  <!-- NAND Gate -->
  <path d="M 275 670 L 300 670 A 10 10 0 0 1 300 690 L 275 690 Z" class="logic-gate"/>
  <circle cx="310" cy="680" r="3" fill="none" stroke="#2e7d32" stroke-width="2"/>
  <text x="287" y="685" class="label" style="font-size: 10px;">NAND</text>
  
  <!-- OR Gate -->
  <path d="M 425 630 C 425 630 430 632 435 640 C 430 648 425 650 425 650 C 440 645 455 640 455 640 C 440 635 425 630 425 630 Z" class="logic-gate"/>
  <text x="440" y="645" class="label" style="font-size: 10px;">OR</text>
  
  <!-- NOR to AND and NAND -->
  <line x1="208" y1="635" x2="250" y2="635" class="connection"/>
  <line x1="250" y1="635" x2="250" y2="600" class="connection"/>
  <line x1="250" y1="600" x2="275" y2="600" class="connection" marker-end="url(#arrowhead)"/>
  <line x1="250" y1="635" x2="250" y2="680" class="connection"/>
  <line x1="250" y1="680" x2="275" y2="680" class="connection" marker-end="url(#arrowhead)"/>
  
  <!-- OUT bit input -->
  <text x="230" y="580" class="signal-label">OUT</text>
  <line x1="250" y1="580" x2="260" y2="580" class="connection"/>
  <line x1="260" y1="580" x2="260" y2="590" class="connection"/>
  <line x1="260" y1="590" x2="275" y2="590" class="connection" marker-end="url(#arrowhead)"/>
  <line x1="260" y1="580" x2="260" y2="690" class="connection"/>
  <line x1="260" y1="690" x2="275" y2="690" class="connection" marker-end="url(#arrowhead)"/>
  
  <!-- NAND to OR -->
  <line x1="313" y1="680" x2="400" y2="680" class="connection"/>
  <line x1="400" y1="680" x2="400" y2="650" class="connection"/>
  <line x1="400" y1="650" x2="425" y2="650" class="connection" marker-end="url(#arrowhead)"/>
  
  <!-- POR input to OR -->
  <text x="380" y="680" class="signal-label">POR</text>
  <line x1="400" y1="680" x2="400" y2="630" class="connection"/>
  <line x1="400" y1="630" x2="425" y2="630" class="connection" marker-end="url(#arrowhead)"/>
  
  <!-- DataLatch (RS Flip-Flop) -->
  <rect x="550" y="600" width="80" height="80" class="flipflop"/>
  <text x="590" y="625" class="label">DataLatch</text>
  <text x="590" y="638" class="label" style="font-size: 9px;">RS Flip-Flop</text>
  
  <!-- OutputUnit4 to DataLatch DATA (rerouted to avoid overlap) -->
  <line x1="470" y1="520" x2="490" y2="520" class="connection"/>
  <line x1="490" y1="520" x2="490" y2="480" class="connection"/>
  <line x1="490" y1="480" x2="540" y2="480" class="connection"/>
  <line x1="540" y1="480" x2="540" y2="620" class="connection"/>
  <line x1="540" y1="620" x2="550" y2="620" class="connection" marker-end="url(#arrowhead)"/>
  <text x="545" y="615" class="signal-label">DATA</text>
  
  <!-- AND to DataLatch SET -->
  <line x1="300" y1="600" x2="500" y2="600" class="connection"/>
  <line x1="500" y1="600" x2="500" y2="640" class="connection"/>
  <line x1="500" y1="640" x2="550" y2="640" class="connection" marker-end="url(#arrowhead)"/>
  <text x="530" y="635" class="signal-label">SET</text>
  
  <!-- OR to DataLatch RESET -->
  <line x1="455" y1="640" x2="490" y2="640" class="connection"/>
  <line x1="490" y1="640" x2="490" y2="660" class="connection"/>
  <line x1="490" y1="660" x2="550" y2="660" class="connection" marker-end="url(#arrowhead)"/>
  <text x="530" y="655" class="signal-label">RESET</text>
  
  <!-- Timer Clock to DataLatch -->
  <text x="480" y="720" class="signal-label">Timer Clock</text>
  <line x1="520" y1="720" x2="590" y2="720" class="connection"/>
  <line x1="590" y1="720" x2="590" y2="680" class="connection" marker-end="url(#arrowhead)"/>
  <text x="570" y="715" class="signal-label">CLK</text>
  
  <!-- DataLatch Q output -->
  <line x1="630" y1="640" x2="680" y2="640" class="connection"/>
  <text x="680" y="635" class="signal-label">Q</text>
  
  <!-- Q distribution (rerouted to avoid overlap) -->
  <circle cx="680" cy="640" r="3" class="branch-point"/>
  <line x1="680" y1="640" x2="750" y2="640" class="connection"/>
  <line x1="680" y1="640" x2="680" y2="460" class="connection"/>
  <line x1="680" y1="460" x2="420" y2="460" class="connection"/>
  <line x1="420" y1="460" x2="420" y2="500" class="connection" marker-end="url(#arrowhead)"/>
  
  <!-- OUT6 output -->
  <text x="760" y="645" class="signal-label">OUT6</text>
  <line x1="750" y1="640" x2="740" y2="640" class="connection" marker-end="url(#arrowhead)"/>
  
  <!-- Out6 feedback label -->
  <text x="530" y="455" class="signal-label">Out6</text>
  
  <!-- EQU0 output -->
  <text x="750" y="520" class="signal-label">EQU0</text>
  <line x1="470" y1="520" x2="730" y2="520" class="connection" marker-end="url(#arrowhead)"/>
  <text x="580" y="515" class="signal-label">(to Timer Mode Control)</text>
  
  <!-- Section grouping boxes -->
  <rect x="70" y="65" width="200" height="100" fill="none" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
  <rect x="280" y="120" width="350" height="160" fill="none" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
  <rect x="220" y="310" width="400" height="100" fill="none" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
  <rect x="150" y="490" width="550" height="220" fill="none" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
  
</svg>