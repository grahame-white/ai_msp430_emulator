#!/usr/bin/env bash
# script/lint
# Run code analysis and formatting checks

set -e

cd "$(dirname "$0")/.."

echo "==> Running MSP430 Emulator code analysis..."

# Format code (check only, don't modify)
echo "==> Checking code formatting..."
dotnet format --verify-no-changes --verbosity diagnostic

# Run static analysis via build with warnings as errors
echo "==> Running static analysis..."
dotnet build --configuration Release --verbosity quiet

# Lint Markdown documentation
echo "==> Linting Markdown documentation..."
if command -v markdownlint-cli2 >/dev/null 2>&1; then
    markdownlint-cli2 "docs/**/*.md" "*.md"
else
    echo "Warning: markdownlint-cli2 not found. Install with: npm install -g markdownlint-cli2"
fi

echo "==> Code analysis completed successfully!"