#!/usr/bin/env bash
# script/setup
# Set up the project for development

set -e

cd "$(dirname "$0")/.."

echo "==> Setting up MSP430 Emulator development environment..."

# Check if .NET 8.0 is installed
if ! command -v dotnet &> /dev/null; then
    echo "Error: .NET SDK is not installed. Please install .NET 8.0 SDK."
    exit 1
fi

# Check .NET version
DOTNET_VERSION=$(dotnet --version)
echo "==> Found .NET version: $DOTNET_VERSION"

# Restore dependencies
echo "==> Restoring NuGet packages..."
dotnet restore

# Build the solution
echo "==> Building solution..."
dotnet build --configuration Debug

# Setup git hooks for automatic formatting
echo "==> Setting up git hooks..."
git config core.hooksPath .githooks

echo "==> Setup completed successfully!"
echo ""
echo "The following git hooks are now active:"
echo "  - pre-commit: Automatically formats code before commits"
echo ""
echo "Available commands:"
echo "  script/build   - Build the project"
echo "  script/test    - Run all tests"
echo "  script/format  - Format code"
echo "  script/lint    - Check code formatting"
echo "  script/update  - Update dependencies"
echo "  script/server  - Run the emulator"
echo "  script/console - Start interactive console"